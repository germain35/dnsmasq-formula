{%- set dnsmasq = pillar.get('dnsmasq', {}) %}
{%- set settings = dnsmasq.get('settings', {}) %}
#
# This file is managed/autogenerated by salt.
# Modify the salt pillar that generates this file instead of dnsmasq.conf.
#
#
# Configuration file for dnsmasq.
#
# Format is one option per line, legal options are the same
# as the long options legal on the command line. See
# "/usr/sbin/dnsmasq --help" or "man 8 dnsmasq" for details.


################################################################################
# The following settings were injected by salt
# See below for default dnsmasq.conf settings
{%- macro print_config(name, value) %}
    {%- if value|lower == "true" %}
        {#- On/off options in the dnsmasq configuration file are odd.   #}
        {#- Print only the name of the setting (e.g., domain-needed).   #}
{{ name }}
    {%- elif value|lower == "false" %}
        {#- On/off options in the dnsmasq configuration file are odd.   #}
        {#- If the user set to False, print nothing.                    #}
    {%- elif value is string %}
{{ name }}={{ value }}
    {%- elif value is number %}
{{ name }}={{ value }}
    {%- else %}
    {#- Since strings are also sequences, there's no way to explicitly test for lists #}
{{ name }}={{ value|first }}
        {%- if value|length > 1 %}
            {%- for item in value[1:] %}
{{ name }}={{ item }}
            {%- endfor %}
        {%- endif %}
    {%- endif %}
{%- endmacro %}

{%- set settings_items = settings.iteritems()|list %}
{%- if dnsmasq.hosts is defined and not 'addn-hosts' in settings %}
{%- do settings_items.append(('addn-hosts', addn_hosts)) %}
{%- endif %}

{%- for name, value in settings_items|sort %}
{{- print_config(name, value) }}
{%- endfor %}
